---
  - name: Demonstrating variables in Jinja2 Loops
    hosts: localhost
    connection: local
    vars:
       PE: 
        - PE
        - QA
        - PROD
       AV:
        - AV
        - SMB

    tasks:
      - name: block in file with items
        blockinfile:
          dest: ./text.txt
          insertafter: BOF
          state: present
          block: |
              - name: {{ PE }} Broadsoft - RI {{ AV }} Install 2.9_3.x
                    description: This Workflow includes VM cloning from the existing template and install broadsoft on top of it
                    extra_vars:
                      application: broadsoft
                      app_domain: {{ AV }}   
                    survey_enabled: true
                    allow_simultaneous: false
                    ask_variables_on_launch: false
                    inventory:
                    state: present
                    limit:
                    ask_labels_on_launch: false
                    ask_skip_tags_on_launch: false
                    labels:
                      - {{ PE }}
                    scm_branch:
                    ask_inventory_on_launch: true
                    ask_scm_branch_on_launch: false
                    ask_limit_on_launch: false
                    organization: Test_Org
                    schedules:
                    simplified_workflow_nodes:
          marker: "# {mark} ANSIBLE MANAGED BLOCK {{item}}"
        vars:
           block_var:
              PE: 
                - PE
                - QA
                - PROD
              AV:
                - AV
                - SMB
        with_items:
            - PE
            - QA
            - PROD
            - AV
            - SMB
