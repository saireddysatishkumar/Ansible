---
  - name: Demonstrating variables in Jinja2 Loops
    hosts: localhost
    connection: local

    tasks:
      - name: line insert
        lineinfile:
          path: "temp.yml"
          line: "controller_workflows:"
          create: yes
      - name: block in file with items
        blockinfile:
          dest: ./temp.yml
          insertafter: BOF
          state: present
          block: |
              - name: {{ PE }} Broadsoft - RI {{ AV }} Install 2.9_3.x
                    description: This Workflow includes VM cloning from the existing template and install broadsoft on top of it
                    extra_vars:
                      application: broadsoft
                      app_domain: {{ AV }}   
                    survey_enabled: true
                    allow_simultaneous: false
                    ask_variables_on_launch: false
                    inventory:
                    state: present
                    limit:
                    ask_labels_on_launch: false
                    ask_skip_tags_on_launch: false
                    labels:
                      - {{ PE }}
                    scm_branch:
                    ask_inventory_on_launch: true
                    ask_scm_branch_on_launch: false
                    ask_limit_on_launch: false
                    organization: Test_Org
                    schedules:
                    simplified_workflow_nodes:
          marker: "# {mark}comment"
        vars:
            - PE: "{{ item.name }}"
            - AV: "{{ item.value }}"
        with_items:
          - name: PE
            value: AV
          - name: QA
            value: AV
          - name: PROD
            value: AV
          - name: PE
            value: SMB
          - name: QA
            value: SMB
          - name: PROD
            value: SMB

      - name: Move foo to bar
        command: mv ./temp.yml output_results.yml