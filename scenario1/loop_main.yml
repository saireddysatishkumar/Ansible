---
  - name: Demonstrating variables in Jinja2 Loops
    hosts: localhost
    connection: local
    vars:
       A: 
        - PE
        - QA
        - PROD
       B:
        - AV
        - SMB

    tasks:
      - name: update1 
        template: src=./templates/controller_workflows dest=./temp/{{ item[0] }}-{{ item[1] }}output.yml
        vars:
          PE: "{{ item[0] }}"
          AV: "{{ item[1] }}"
        loop: "{{ A | product(B) | list }}"

      - name: List all files in the folder
        find:
          paths: ./temp
          recurse: yes
          file_type: file
        register: files_to_append

      - name: Initialize the concatenated file
        copy:
          content: ""
          dest: output_results1.yml

      - name: Append files to the concatenated file
        assemble:
          src: ./temp
          dest: output_results1.yml
        with_items: "{{ files_to_append.files }}"

      - name: line insert
        lineinfile:
          path: "output_results1.yml"
          line: "controller_workflows:"
          insertbefore: BOF